/*!
 * jQuery UI date range picker widget
 * Copyright (c) 2017 Tamble, Inc.
 * Licensed under MIT (https://github.com/tamble/jquery-ui-daterangepicker/raw/master/LICENSE.txt)
 *
 * Depends:
 *   - jQuery 1.8.3+
 *   - jQuery UI 1.9.0+ (widget factory, position utility, button, menu, datepicker)
 *   - moment.js 2.3.0+
 */
!function(t,e,n){var a=0;function i(e,a,i){var o,r,l;return o=t("<div></div>").addClass(e+"-presets"),r=t("<ul></ul>"),l=t.ui.menu.prototype.options.items===n?{start:'<li><a href="#">',end:"</a></li>"}:{start:"<li><div>",end:"</div></li>"},t.each(a.presetRanges,(function(){t(l.start+this.text+l.end).data("dateStart",this.dateStart).data("dateEnd",this.dateEnd).click(i).appendTo(r)})),o.append(r),r.menu().data("ui-menu").delay=0,{getElement:function(){return o}}}t.widget("comiseo.daterangepicker",{version:"0.6.0-beta.1",options:{isRange:!0,initialText:"Select date range...",icon:"ui-icon-triangle-1-s",applyButtonText:"Apply",clearButtonText:"Clear",cancelButtonText:"Cancel",rangeSplitter:" - ",dateFormat:"M d, yy",altFormat:"yy-mm-dd",verticalOffset:0,mirrorOnCollision:!0,autoFitCalendars:!0,applyOnMenuSelect:!0,open:null,close:null,change:null,clear:null,cancel:null,onOpen:null,onClose:null,onChange:null,onClear:null,datepickerOptions:{numberOfMonths:3,maxDate:0}},_create:function(){this._dateRangePicker=function(n,o,r){var l,c,s,u,d,p,f="comiseo-daterangepicker",g=!1,h=!1,m=0,v=1,b=2,k=3,y=["left","right","top","bottom"],O=v,C=null;function R(){s=function(e,n,i){var o,r;function l(){r="drp_autogen"+a++,t('label[for="'+e.attr("id")+'"]').attr("for",r)}function c(){l(),o=t('<button type="button"></button>').addClass(n+"-triggerbutton").attr({title:e.attr("title"),tabindex:e.attr("tabindex"),id:r}).button({icons:{secondary:i.icon},icon:i.icon,iconPosition:"end",label:i.initialText})}function s(){return o.button("option","label")}function u(t){o.button("option","label",t)}function d(){e.val("").change(),u(i.initialText)}function p(){o.button("option",{icons:{secondary:i.icon},icon:i.icon,iconPosition:"end",label:i.initialText})}return c(),{getElement:function(){return o},getLabel:s,setLabel:u,reset:d,enforceOptions:p}}(n,f,r),u=i(f,r,W),d=function(e,n){var a,i={start:null,end:null};function o(){(a=t("<div></div>",{class:e+"-calendar ui-widget-content"})).datepicker(t.extend({},n.datepickerOptions,{beforeShowDay:c,onSelect:l})),s()}function r(){a.datepicker("option",t.extend({},n.datepickerOptions,{beforeShowDay:c,onSelect:l}))}function l(e,a){if(n.isRange){var o=n.datepickerOptions.dateFormat||t.datepicker._defaults.dateFormat,r=t.datepicker.parseDate(o,e);!i.start||i.end?(i.start=r,i.end=null):r<i.start?(i.end=i.start,i.start=r):i.end=r}else t(a.input).val(e);n.datepickerOptions.hasOwnProperty("onSelect")&&n.datepickerOptions.onSelect(e,a)}function c(e){let a=[!0,"",""],o=[!0,"",""];if(n.isRange){const{start:t,end:n}=i;t&&+e==+t&&(a[1]+=" range-start"),n&&+e==+n&&(a[1]+=" range-end"),t&&(+e==+t||n&&t<=e&&e<=n)&&(a[1]+=" ui-state-highlight")}else{const i=t.datepicker.parseDate(n.datepickerOptions.dateFormat||t.datepicker._defaults.dateFormat,t(this).val());i&&+e==+i&&(a[1]+=" ui-state-highlight")}return n.datepickerOptions.hasOwnProperty("beforeShowDay")&&(o=n.datepickerOptions.beforeShowDay(e)),[a[0]&&o[0],(a[1]+" "+o[1]).trim(),a[2]||o[2]]}function s(){setTimeout((function(){d(),s()}),moment().endOf("day")-moment())}function u(){i.start&&a.datepicker("setDate",i.start)}function d(){a.datepicker("refresh"),a.datepicker("setDate",null)}function p(){i={start:null,end:null},d()}return o(),{getElement:function(){return a},scrollToRangeStart:function(){return u()},getRange:function(){return i},setRange:function(t){i=t,d()},refresh:d,reset:p,enforceOptions:r}}(f,r),E.numberOfMonths=r.datepickerOptions.numberOfMonths,E.numberOfMonths instanceof Array&&(r.autoFitCalendars=!1),p=function(e,n,a){var i,o,r,l;function c(){i=t("<div></div>").addClass(e+"-buttonpanel"),n.applyButtonText&&(o=t('<button type="button" class="ui-priority-primary"></button>').text(n.applyButtonText).button(),i.append(o)),n.clearButtonText&&(r=t('<button type="button" class="ui-priority-secondary"></button>').text(n.clearButtonText).button(),i.append(r)),n.cancelButtonText&&(l=t('<button type="button" class="ui-priority-secondary"></button>').text(n.cancelButtonText).button(),i.append(l)),u()}function s(){o&&o.button("option","label",n.applyButtonText),r&&r.button("option","label",n.clearButtonText),l&&l.button("option","label",n.cancelButtonText)}function u(){a&&(o&&o.click(a.onApply),r&&r.click(a.onClear),l&&l.click(a.onCancel))}return c(),{getElement:function(){return i},enforceOptions:s}}(f,r,{onApply:function(t){j(t),B(null,t)},onClear:function(t){j(t),M(t)},onCancel:function(t){o._trigger("cancel",t,{instance:o}),j(t),P()}}),x(),E(),P(),S()}function x(){l=t("<div></div>",{class:f+" "+f+"-"+y[O]+" ui-widget ui-widget-content ui-corner-all ui-front"}).append(t("<div></div>",{class:f+"-main ui-widget-content"}).append(u.getElement()).append(d.getElement())).append(t('<div class="ui-helper-clearfix"></div>').append(p.getElement())).hide(),n.hide().after(s.getElement()),c=t("<div></div>",{class:"ui-front "+f+"-mask"}).hide(),t("body").append(c).append(l)}function E(){if(r.autoFitCalendars){var n=t(e).width(),a=l.outerWidth(!0),i=d.getElement(),o=i.datepicker("option","numberOfMonths"),c=o;if(a>n){for(;o>1&&l.outerWidth(!0)>n;)i.datepicker("option","numberOfMonths",--o);o!==c&&(E.monthWidth=(a-l.outerWidth(!0))/(c-o))}else for(;o<E.numberOfMonths&&n-l.outerWidth(!0)>=E.monthWidth;)i.datepicker("option","numberOfMonths",++o);A(),h=!1}}function w(){l.remove(),s.getElement().remove(),n.show()}function S(){s.getElement().click(z),s.getElement().keydown(N),c.click((function(t){j(t),P()})),t(e).resize((function(){g?E():h=!0}))}function T(e){var n=r.dateFormat;return t.datepicker.formatDate(n,e.start)+(+e.end!=+e.start?r.rangeSplitter+t.datepicker.formatDate(n,e.end):"")}function _(e){var n=r.altFormat,a={};return a.start=t.datepicker.formatDate(n,e.start),a.end=t.datepicker.formatDate(n,e.end),JSON.stringify(a)}function D(e){var n=r.altFormat,a=null;if(e)try{a=JSON.parse(e,(function(e,a){return e?t.datepicker.parseDate(n,a):a}))}catch(t){}return a}function P(){var t=F();t?(s.setLabel(T(t)),d.setRange(t)):d.reset()}function B(t,e){var a=t||d.getRange();a.start&&(a.end||(a.end=a.start),t&&d.setRange(a),s.setLabel(T(a)),n.val(_(a)).change(),r.onChange&&r.onChange(),o._trigger("change",e,{instance:o}))}function F(){return D(n.val())}function M(t){s.reset(),d.reset(),r.onClear&&r.onClear(),o._trigger("clear",t,{instance:o})}function W(e){var n=t(this),a=n.data("dateStart")().startOf("day").toDate(),i=n.data("dateEnd")().startOf("day").toDate();return d.setRange({start:a,end:i}),r.applyOnMenuSelect&&(j(e),B(null,e)),!1}function A(){l.position({my:"left top",at:"left bottom"+(r.verticalOffset<0?r.verticalOffset:"+"+r.verticalOffset),of:s.getElement(),collision:"flipfit flipfit",using:function(t,e){var n,a,i=e.element.left+e.element.width/2,o=e.target.left+e.target.width/2,c=O,p=e.element.top+e.element.height/2,g=e.target.top+e.target.height/2,h=C;(O=i>o?v:m)!==c&&(r.mirrorOnCollision&&(n=O===m?u:d,l.children().first().append(n.getElement())),l.removeClass(f+"-"+y[c]),l.addClass(f+"-"+y[O])),l.css({left:t.left,top:t.top}),(C=p>g?k:b)!==h&&(null!==h&&s.getElement().removeClass(f+"-"+y[h]),s.getElement().addClass(f+"-"+y[C])),a=C===k&&e.element.top-e.target.top!==e.target.height+r.verticalOffset||C===b&&e.target.top-e.element.top!==e.element.height+r.verticalOffset,s.getElement().toggleClass(f+"-vfit",a)}})}function L(t){t.preventDefault(),t.stopPropagation()}function N(e){switch(e.which){case t.ui.keyCode.UP:case t.ui.keyCode.DOWN:return L(e),void J(e);case t.ui.keyCode.ESCAPE:return L(e),j(e),void P();case t.ui.keyCode.TAB:return void j(e)}}function J(t){g||(s.getElement().addClass(f+"-active"),c.show(),g=!0,h&&E(),d.scrollToRangeStart(),l.show(),A()),r.onOpen&&r.onOpen(),o._trigger("open",t,{instance:o})}function j(t){g&&(l.hide(),c.hide(),s.getElement().removeClass(f+"-active"),g=!1),r.onClose&&r.onClose(),o._trigger("close",t,{instance:o})}function z(t){g?(j(t),P()):J(t)}function Q(){return l}function U(){var t=u;u=i(f,r,W),t.getElement().replaceWith(u.getElement()),d.enforceOptions(),p.enforceOptions(),s.enforceOptions();var e=F();e&&s.setLabel(T(e))}return R(),{toggle:z,destroy:w,open:J,close:j,setRange:B,getRange:F,clearRange:M,reset:P,enforceOptions:U,getContainer:Q}}(this.element,this,this.options)},_destroy:function(){this._dateRangePicker.destroy()},_setOptions:function(t){this._super(t),this._dateRangePicker.enforceOptions()},open:function(){this._dateRangePicker.open()},close:function(){this._dateRangePicker.close()},setRange:function(t){this._dateRangePicker.setRange(t)},getRange:function(){return this._dateRangePicker.getRange()},clearRange:function(){this._dateRangePicker.clearRange()},widget:function(){return this._dateRangePicker.getContainer()}})}(jQuery,window);